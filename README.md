# スイングトレード練習アプリ

過去の株価データを使って、時間圧縮しながらスイングトレードの練習ができるiPhone向けPWAアプリです。

## 🎯 目的

- スイングトレード初心者が効率的に上達できるよう設計
- リアルタイムより早く多くの経験を積める時間圧縮機能
- 勝率7割達成に向けた成長を可視化

## ✨ 主な機能

### チャート機能

- 日足チャート表示（ローソク足）
- 移動平均線5本（期間カスタマイズ可能）
- 出来高表示
- ロング/ショート（空売り）対応
- 過去データを一日単位で進める再生機能
- 未来のデータは不可視

### 売買機能

- 仮想時間の進行を一時停止して注文入力
- 取引理由をメモとして記録
- 現物取引と信用取引の選択
- 手数料・スリッページを考慮した計算
- ポジションの決済

### セッション機能

- 初期資金100万円でスタート
- 期間は20/40/60日から選択可能
- 出来高が一定以上の銘柄を自動抽出（日本株100銘柄）
- 再生速度の調整（5〜30秒/日）
- セッション途中での保存・再開

### 自動計算される指標

- セッションID（固有の識別子）
- 期間・銘柄
- トレード回数
- 勝率
- 最終資金
- 最大ドローダウン（DD）
- ルール違反回数

### ルール違反チェック

1. **損切りルール違反**: 含み損が-10%を超えても決済しない
2. **ポジションサイズ違反**: 1銘柄に資金の30%以上を投入
3. **同時保有数違反**: 3銘柄以上を同時保有
4. **レバレッジ違反**: レバレッジ2倍以上

### 戦績確認

- ダッシュボードで統計を可視化
- セッション一覧で成績を比較
- 詳細ビューでチャート上に売買マークを表示
- 吹き出しで取引理由を確認

## 🛠 技術スタック

- **フレームワーク**: Next.js 15 (App Router)
- **UI**: React + TypeScript
- **スタイリング**: Tailwind CSS + shadcn/ui
- **チャート**: Lightweight Charts (TradingView製)
- **状態管理**: Zustand
- **データベース**: SQLite (better-sqlite3)
- **日付処理**: date-fns
- **株価データ**: Yahoo Finance API（キャッシュ機能付き）

## 📦 セットアップ

### 前提条件

- Node.js 18以上
- npm または yarn

### インストール

```bash
# リポジトリをクローン
git clone <repository-url>
cd swing-trader-practice

# 依存パッケージをインストール
npm install

# 開発サーバーを起動
npm run dev
```

ブラウザで http://localhost:3000 を開きます。

### 初回起動時の設定

1. **ユーザー登録**: ログイン画面でニックネームを入力して登録
2. **株価データ取得**: 自動的にキャッシュされますが、必要に応じて以下のコマンドで更新可能

```bash
# 株価データを更新（オプション）
npm run update-stock-data
```

### ビルド

```bash
# プロダクションビルド
npm run build

# プロダクションサーバーを起動
npm start
```

## 📁 データの保存場所

アプリケーションは以下のディレクトリにデータを保存します：

- `data/users/` - ユーザー情報（自動生成）
- `data/sessions.db` - セッションデータ（SQLite）
- `lib/data/cache/` - 株価データキャッシュ（自動生成）

これらのファイルは`.gitignore`で除外されているため、各ユーザーのローカル環境で個別に管理されます。

## 📱 PWAとして使用

### iPhoneでの使用方法

1. 開発サーバーを起動（`npm run dev`）
2. 同じネットワーク上のiPhoneでアクセス（例: http://192.168.x.x:3000）
3. Safariで開く
4. 共有ボタンをタップ
5. 「ホーム画面に追加」を選択
6. アプリがホーム画面に追加されます

### PWA機能

- オフライン動作
- ネイティブアプリのような操作感
- SQLiteによるローカルデータ保存
- セッション中断・再開機能

## 📊 データについて

### 株価データ

- **データソース**: Yahoo Finance APIから日本株の実データを取得
- **対象銘柄**: 出来高が多い主要100銘柄程度を自動抽出
- **期間**: 直近500日分のデータをキャッシュ
- **更新**: 初回起動時に自動取得、以降は手動更新も可能

### データ管理

- ユーザーデータとセッションデータは各環境で独立して保存
- 株価データはキャッシュとして保存され、定期的な更新が可能
- すべての個人データは`.gitignore`で除外されており、リポジトリには含まれません

## 🎮 使い方

### 1. ログイン

1. 初回起動時にニックネームを入力して登録
2. 次回以降は同じニックネームでログイン

### 2. 新規セッション開始

1. トップページで「新規セッション」をクリック
2. 期間（20/40/60日）を選択
3. 再生速度を設定
4. 「セッション開始」をクリック

### 3. トレード実行

1. チャートを確認しながら、再生ボタンで時間を進める
2. 取引したいタイミングで一時停止
3. 右側の注文フォームで買い/売り、現物/信用、株数を入力
4. 取引理由をメモに記入
5. 「注文を実行」をクリック

### 4. ポジション管理

- 保有ポジションは自動的に含み損益を計算
- 決済したいタイミングで「決済」ボタンをクリック

### 5. セッション完了

- 設定した期間が終了すると自動的にセッション完了
- 結果が履歴に保存されます

### 6. 成長の確認

- 履歴ページで過去のセッションを振り返る
- 勝率の推移、損益率などを分析
- 目標の勝率70%を目指す

## 📈 推奨される練習方法

1. **短期間から始める**: 最初は20日セッションで練習
2. **メモを必ず記録**: なぜその取引をしたのか明確に
3. **ルール違反を減らす**: 損切りルールを守る習慣をつける
4. **セッションを重ねる**: 10回以上のセッションで傾向を把握
5. **振り返りを行う**: 履歴から成功・失敗パターンを分析

## 🔧 カスタマイズ

### 移動平均線の期間変更

セッション開始時に5本の移動平均線の期間を変更できます。
デフォルト: 5, 25, 75, 100, 200日線

### ルール違反の閾値変更

[lib/trading/calculator.ts](lib/trading/calculator.ts)の`RULE_LIMITS`を編集することで、ルール違反の基準を変更できます。

### 株価データの更新

```bash
# 株価データを手動で更新
npm run update-stock-data
```

## 🔒 プライバシー

- すべてのユーザーデータとセッションデータはローカルに保存されます
- 外部サーバーへのデータ送信は行いません（株価取得APIを除く）
- 株価データは`lib/data/cache/`にキャッシュされ、再利用されます

## 🤝 コントリビューション

バグ報告や機能リクエストは Issues でお願いします。
プルリクエストも歓迎します。

## 📄 ライセンス

MIT

## 🙏 謝辞

- チャートライブラリ: TradingView Lightweight Charts
- アイコン: Lucide Icons
- 株価データ: Yahoo Finance API
